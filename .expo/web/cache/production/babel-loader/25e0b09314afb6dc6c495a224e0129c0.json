{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useState}from'react';import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Image from\"react-native-web/dist/exports/Image\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import Button from\"react-native-web/dist/exports/Button\";import{useDispatch,useSelector}from'react-redux';import{userConnected,setSpotifyToken}from\"../redux/user\";import*as Linking from'expo-linking';import*as WebBrowser from'expo-web-browser';import{makeRedirectUri,useAuthRequest,ResponseType}from'expo-auth-session';WebBrowser.maybeCompleteAuthSession();var discovery={authorizationEndpoint:'https://accounts.spotify.com/authorize',tokenEndpoint:'https://accounts.spotify.com/api/token'};var ConnectService=function ConnectService(_ref){var navigation=_ref.navigation;var storeToken=useSelector(function(state){return state.user.spotify_token;});var dispatch=useDispatch();var _useAuthRequest=useAuthRequest({responseType:ResponseType.Token,clientId:'67234dda13844207a07446c5f1672ca6',scopes:['user-read-recently-played','user-read-playback-position','user-read-email','playlist-modify-public','user-read-private','playlist-read-private','user-library-read','user-library-modify','user-top-read','playlist-read-collaborative','playlist-modify-private','ugc-image-upload','user-follow-read','user-follow-modify','user-read-playback-state','user-modify-playback-state','user-read-currently-playing'],usePKCE:false,redirectUri:makeRedirectUri({scheme:'com.jukehome'})==null?makeRedirectUri({scheme:'com.jukehome'}):\"https://theojeanningrosepitech.github.io/lug/\"},discovery),_useAuthRequest2=_slicedToArray(_useAuthRequest,3),request=_useAuthRequest2[0],response=_useAuthRequest2[1],promptAsync=_useAuthRequest2[2];function getTrack(){var token;return _regeneratorRuntime.async(function getTrack$(_context){while(1){switch(_context.prev=_context.next){case 0:token=JSON.parse(storeToken);console.log(\"--- getTrack() ---\");fetch('https://api.spotify.com/v1/tracks/id='+token,{method:'GET'}).then(function(response){return response.json();}).then(function(response){console.log(\"Server said: \"+response);});case 3:case\"end\":return _context.stop();}}},null,null,null,Promise);}React.useEffect(function(){console.log(\"response ======== \",response);if((response==null?void 0:response.type)==='success'){console.log(\"request  \"+request.url);console.log(\"request  \"+request.codeChallenge);var access_token=response.params.access_token;console.log(access_token);var token=access_token;dispatch(setSpotifyToken(JSON.stringify(token)));}},[response]);var user=useSelector(function(state){return state.user.user;});if(response==null||response.type==\"dismiss\"){console.log(\"user\",user);return React.createElement(View,{style:styles.container},React.createElement(Text,{style:styles.connectation},\" Connect via \"),React.createElement(View,null,React.createElement(TouchableOpacity,{onPress:function _callee(){return _regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(promptAsync());case 2:case\"end\":return _context2.stop();}}},null,null,null,Promise);}},React.createElement(Image,{source:require(\"../assets/spotifyBlanc.png\"),resizeMode:\"contain\",style:styles.spotLogo,imageStyle:styles.image_imageStyle}))));}else{console.log(\"user\",user);console.log(\"responsebbbbbb\",response);return React.createElement(View,{style:styles.container},React.createElement(Text,{style:styles.connectation},\" Connect via \"),React.createElement(View,null,React.createElement(TouchableOpacity,{onPress:dispatch(userConnected())},React.createElement(Text,{style:styles.connectation},\" GO \"))));}};var styles=StyleSheet.create({container:{flex:1,flexDirection:\"column\",backgroundColor:'#120841',padding:50,alignItems:'center',justifyContent:'center'},spotLogo:{width:300,height:90},mediumLogo:{width:66,height:90},connectation:{alignItems:'center',fontSize:20,color:\"white\",fontWeight:\"bold\",paddingBottom:10}});export default ConnectService;","map":{"version":3,"sources":["/home/jeanningros/lug/components/ConnectService.js"],"names":["React","useState","useDispatch","useSelector","userConnected","setSpotifyToken","Linking","WebBrowser","makeRedirectUri","useAuthRequest","ResponseType","maybeCompleteAuthSession","discovery","authorizationEndpoint","tokenEndpoint","ConnectService","navigation","storeToken","state","user","spotify_token","dispatch","responseType","Token","clientId","scopes","usePKCE","redirectUri","scheme","request","response","promptAsync","getTrack","token","JSON","parse","console","log","fetch","method","then","json","useEffect","type","url","codeChallenge","access_token","params","stringify","styles","container","connectation","require","spotLogo","image_imageStyle","StyleSheet","create","flex","flexDirection","backgroundColor","padding","alignItems","justifyContent","width","height","mediumLogo","fontSize","color","fontWeight","paddingBottom"],"mappings":"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","sourcesContent":["\nimport React, {useState} from 'react';\nimport { TouchableOpacity, Image, StyleSheet, Text, View, Button} from 'react-native';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { userConnected, setSpotifyToken } from '../redux/user';\nimport * as Linking from 'expo-linking';\n\nimport * as WebBrowser from 'expo-web-browser';\nimport { makeRedirectUri, useAuthRequest, ResponseType } from 'expo-auth-session';\n\nWebBrowser.maybeCompleteAuthSession();\n\nconst discovery = {\n  authorizationEndpoint: 'https://accounts.spotify.com/authorize',\n  tokenEndpoint: 'https://accounts.spotify.com/api/token',\n};\n\nconst ConnectService = ({ navigation }) => {\n  const storeToken = useSelector((state) => state.user.spotify_token);\n  const dispatch = useDispatch();\n ///TODO: FIX URI Redirection\n //const prefix = Linking.createURL('/spotifypage');\n\n  const [request, response, promptAsync] = useAuthRequest(\n    {\n      responseType: ResponseType.Token,\n      clientId: '67234dda13844207a07446c5f1672ca6',\n      scopes: ['user-read-recently-played', 'user-read-playback-position', 'user-read-email', 'playlist-modify-public', 'user-read-private', 'playlist-read-private', 'user-library-read', 'user-library-modify','user-top-read','playlist-read-collaborative','playlist-modify-private', 'ugc-image-upload', 'user-follow-read', 'user-follow-modify', 'user-read-playback-state', 'user-modify-playback-state', 'user-read-currently-playing'],\n      // In order to follow the \"Authorization Code Flow\" to fetch token after authorizationEndpoint\n      // this must be set to false\n      usePKCE: false,\n      // redirectUri: makeRedirectUri({\n      //   scheme: 'jukehome.app://callback'\n      //   }),\n      redirectUri: makeRedirectUri({ scheme: 'com.jukehome' }) == null ? makeRedirectUri({ scheme: 'com.jukehome' }) : \"https://theojeanningrosepitech.github.io/lug/\"\n      //redirectUri: makeRedirectUri({ native: Linking.getInitialURL })\n  \n    },\n    discovery\n  );\n  //console.log(\"prefix\", {prefix});\n\n  async function getTrack() {\n    // const token = JSON.parse(localStorage.getItem('token'));\n    const token = JSON.parse(storeToken);\n    console.log(\"--- getTrack() ---\");\n    fetch( 'https://api.spotify.com/v1/tracks/id=' + token,  {\n        method: 'GET',\n    })\n    .then(response => response.json())\n    .then((response) => {\n        console.log(\"Server said: \" + response);\n    });\n  }\n\n  React.useEffect(() => {\n    console.log(\"response ======== \", response);\n    if (response?.type === 'success') {\n      console.log(\"request  \"  +request.url);\n      console.log(\"request  \"  +request.codeChallenge);\n      const { access_token } = response.params;\n      console.log(access_token);\n      const token = access_token;\n      // localStorage.setItem('token', JSON.stringify(token));\n      dispatch(setSpotifyToken(JSON.stringify(token)));\n    }\n  }, [response]);\n\n  /// \n  const user = useSelector((state) => state.user.user);\n\n  if (response == null || response.type == \"dismiss\") {\n    console.log(\"user\", user)\n    return (\n      <View style={styles.container}>\n        \n        {/* <Button\n          title='connect to Spotify'\n          onPress={() => dispatch(userConnected())}\n        /> */}\n        <Text style={styles.connectation}> Connect via </Text>\n        <View>\n          <TouchableOpacity onPress={async ()=> {\n              await promptAsync();\n            \n            }\n            \n            }>\n            <Image\n              source={require(\"../assets/spotifyBlanc.png\")}\n              resizeMode=\"contain\"\n              style={styles.spotLogo}\n              imageStyle={styles.image_imageStyle}\n            /> \n          </TouchableOpacity>\n        </View>\n      </View>\n    );\n\n  } else {\n    console.log(\"user\", user)\n    console.log(\"responsebbbbbb\", response)\n    return (\n      <View style={styles.container}>\n        \n        {/* <Button\n          title='connect to Spotify'\n          onPress={() => dispatch(userConnected())}\n        /> */}\n        <Text style={styles.connectation}> Connect via </Text>\n        <View>\n          <TouchableOpacity onPress={\n            dispatch(userConnected())\n            }>\n           <Text style={styles.connectation}> GO </Text>\n\n          </TouchableOpacity>\n        </View>\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: \"column\",\n    backgroundColor: '#120841',\n    // fontFamily: 'Roboto',\n    padding: 50,\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  spotLogo: {\n    width: 300,\n    height: 90,\n  },\n  mediumLogo: {\n    width: 66,\n    height: 90,\n  },\n\n  connectation: {\n    alignItems: 'center',\n    fontSize: 20,\n    color: \"white\",\n    fontWeight: \"bold\",\n    paddingBottom: 10,\n  }\n  \n\n});\n\nexport default ConnectService;"]},"metadata":{},"sourceType":"module"}